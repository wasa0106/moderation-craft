# ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

ModerationCraftã®ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã€å€‹äººå‰µä½œè€…ã®ç”Ÿç”£æ€§ã¨å¥åº·ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆçš„ã«åˆ†æã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãªæ´å¯Ÿã‚’æä¾›ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ â†’ Lambda â†’ S3ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ â†’ dbt â†’ DuckDB â†’ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | èª¬æ˜ | çŠ¶æ…‹ |
|--------------|------|------|
| **DynamoDB** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ | âœ… ç¨¼åƒä¸­ |
| **Lambda Functions** | ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡¦ç† | âœ… å®Ÿè£…æ¸ˆã¿ |
| **S3 Data Lake** | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ï¼ˆraw/staging/goldå±¤ï¼‰ | âœ… æ§‹ç¯‰æ¸ˆã¿ |
| **EventBridge** | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼ˆæ—¥æ¬¡14:00 JSTï¼‰ | âœ… è¨­å®šæ¸ˆã¿ |
| **dbt** | ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚° | ğŸ”„ Phase 3ã§å®Ÿè£…äºˆå®š |
| **DuckDB** | åˆ†æã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆWASMå¯¾å¿œï¼‰ | ğŸ”„ Phase 3ã§å®Ÿè£…äºˆå®š |
| **Hugging Face** | MLæ¨è«– | ğŸ”„ Phase 4ã§å®Ÿè£…äºˆå®š |

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤æ§‹ç¯‰ âœ… å®Œäº†ï¼ˆ2024å¹´2æœˆï¼‰

**å®Ÿè£…å†…å®¹**:
- S3ãƒã‚±ãƒƒãƒˆä½œæˆã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«è¨­å®š
- Lambdaé–¢æ•°ã«ã‚ˆã‚‹DynamoDB â†’ S3ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- EventBridgeã«ã‚ˆã‚‹æ—¥æ¬¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆï¼ˆãƒ‡ãƒãƒƒã‚°UIï¼‰

**æˆæœç‰©**:
- [å®Ÿè£…è¨ˆç”»æ›¸](./implementation-overview.md)
- [ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰ã‚¬ã‚¤ãƒ‰](./phase-1-infrastructure.md)
- [çµ±åˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰](./phase-1-integration.md)
- [æŠ€è¡“ä»•æ§˜æ›¸](./technical-specifications.md)

**ç¾åœ¨ã®æ©Ÿèƒ½**:
- âœ… æ—¥æ¬¡è‡ªå‹•ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆ14:00 JSTï¼‰
- âœ… æ‰‹å‹•ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œ
- âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´è¡¨ç¤º
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- âœ… ãƒ‡ãƒãƒƒã‚°UIï¼ˆ`/debug/pipeline`ï¼‰

### Phase 2: å¤–éƒ¨é€£æº ğŸ”„ æ¬¡æœŸå®Ÿè£…

**è¨ˆç”»å†…å®¹**:
- Fitbit APIã¨ã®OAuthèªè¨¼çµ±åˆ
- å¤©å€™ãƒ‡ãƒ¼ã‚¿APIï¼ˆOpenWeatherMapï¼‰çµ±åˆ
- ãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [å¤–éƒ¨é€£æºå®Ÿè£…è¨ˆç”»](./phase-2-external-integration.md)

### Phase 3: åˆ†æåŸºç›¤ ğŸ“… è¨ˆç”»ä¸­

**è¨ˆç”»å†…å®¹**:
- dbtãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹ç¯‰
- ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ãƒˆä½œæˆï¼ˆGoldå±¤ï¼‰
- DuckDB WASMçµ±åˆ
- ãƒ–ãƒ©ã‚¦ã‚¶å†…åˆ†ææ©Ÿèƒ½

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [åˆ†æåŸºç›¤å®Ÿè£…è¨ˆç”»](./phase-3-analytics-foundation.md)

### Phase 4: é«˜åº¦ãªåˆ†æ ğŸ“… è¨ˆç”»ä¸­

**è¨ˆç”»å†…å®¹**:
- ç›¸é–¢åˆ†æã®å®Ÿè£…
- Hugging Face MLçµ±åˆ
- äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [é«˜åº¦ãªåˆ†æå®Ÿè£…è¨ˆç”»](./phase-4-advanced-analytics.md)

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ï¼ˆPhase 1ï¼‰

```mermaid
graph LR
    A[DynamoDB] -->|Lambda| B[S3 Rawå±¤]
    B -->|å°†æ¥| C[S3 Stagingå±¤]
    C -->|å°†æ¥| D[S3 Goldå±¤]
    
    style A fill:#90EE90
    style B fill:#90EE90
    style C fill:#FFE4B5
    style D fill:#FFE4B5
```

### å®Œå…¨å®Ÿè£…æ™‚ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```mermaid
graph TB
    subgraph å†…éƒ¨ãƒ‡ãƒ¼ã‚¿
        A1[DynamoDB]
        A2[IndexedDB]
    end
    
    subgraph å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿
        B1[Fitbit API]
        B2[Weather API]
        B3[Calendar API]
    end
    
    subgraph ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯
        C1[Rawå±¤]
        C2[Stagingå±¤]
        C3[Goldå±¤]
        C4[MLå±¤]
    end
    
    subgraph åˆ†æ
        D1[dbt]
        D2[DuckDB]
        D3[Hugging Face]
    end
    
    subgraph ã‚µãƒ¼ãƒ“ãƒ³ã‚°
        E1[ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
        E2[ãƒ¬ãƒãƒ¼ãƒˆ]
        E3[API]
    end
    
    A1 --> C1
    A2 --> C1
    B1 --> C1
    B2 --> C1
    B3 --> C1
    
    C1 --> D1
    D1 --> C2
    C2 --> C3
    C3 --> D2
    C3 --> D3
    D3 --> C4
    
    D2 --> E1
    D2 --> E2
    C3 --> E3
```

## S3ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯æ§‹é€ 

```
s3://moderation-craft-data-800860245583/
â”œâ”€â”€ raw/                          # ç”Ÿãƒ‡ãƒ¼ã‚¿å±¤
â”‚   â”œâ”€â”€ internal/                 # å†…éƒ¨ãƒ‡ãƒ¼ã‚¿
â”‚   â”‚   â””â”€â”€ dynamodb-exports/     # DynamoDBã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â”‚       â””â”€â”€ dt=YYYY-MM-DD/    # æ—¥ä»˜ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ external/                 # å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ï¼ˆPhase 2ï¼‰
â”‚       â”œâ”€â”€ fitbit/
â”‚       â””â”€â”€ weather/
â”œâ”€â”€ staging/                      # å¤‰æ›ä¸­é–“å±¤ï¼ˆPhase 3ï¼‰
â”œâ”€â”€ gold/                        # åˆ†æç”¨ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ãƒˆï¼ˆPhase 3ï¼‰
â””â”€â”€ ml/                          # æ©Ÿæ¢°å­¦ç¿’ç”¨ï¼ˆPhase 4ï¼‰
```

## è¨­å®šæƒ…å ±

### AWS ãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹ | åå‰/ID | èª¬æ˜ |
|---------|---------|------|
| **S3 Bucket** | moderation-craft-data-800860245583 | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ |
| **Lambda Function** | moderation-craft-export-dynamodb | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡¦ç† |
| **DynamoDB Table** | moderation-craft-data | ã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ |
| **IAM Role** | moderation-craft-lambda-role | Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ« |
| **EventBridge Rule** | trigger-mc-daily-export | æ—¥æ¬¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« |

### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

- **æ—¥æ¬¡ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: æ¯æ—¥ 14:00 JST (05:00 UTC)
- **cronå¼**: `cron(0 5 * * ? *)`

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ãƒ‡ãƒãƒƒã‚°UIã¸ã‚¢ã‚¯ã‚»ã‚¹

```
http://localhost:3000/debug/pipeline
```

### 2. æ‰‹å‹•ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œ

1. ã€Œæ‰‹å‹•ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å®Ÿè¡Œçµæœã‚’ç¢ºèª
3. S3ã«ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª

### 3. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´ç¢ºèª

1. ã€Œå±¥æ­´ã€ã‚¿ãƒ–ã‚’é–‹ã
2. éå»ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¸€è¦§ã‚’ç¢ºèª
3. å¿…è¦ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

## APIä»•æ§˜

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|--------------|---------|------|
| `/api/pipeline/export` | POST | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œ |
| `/api/pipeline/status` | GET | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾— |
| `/api/pipeline/latest` | GET | æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾— |

è©³ç´°ã¯[æŠ€è¡“ä»•æ§˜æ›¸](./technical-specifications.md)ã‚’å‚ç…§ã€‚

## ãƒ†ã‚¹ãƒˆ

ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¨ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯[ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./testing-strategy.md)ã‚’å‚ç…§ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### CloudWatchãƒ­ã‚°ç¢ºèª

```bash
aws logs tail /aws/lambda/moderation-craft-export-dynamodb --follow
```

### S3ãƒ‡ãƒ¼ã‚¿ç¢ºèª

```bash
aws s3 ls s3://moderation-craft-data-800860245583/raw/internal/dynamodb-exports/ --recursive
```

### Lambdaæ‰‹å‹•å®Ÿè¡Œ

```bash
aws lambda invoke \
  --function-name moderation-craft-export-dynamodb \
  --payload '{"tableName":"moderation-craft-data"}' \
  response.json
```

## é–¢é€£ãƒªãƒ³ã‚¯

### å†…éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [æ©Ÿèƒ½èª¬æ˜æ›¸](/docs/features/pipeline-management.md)
- [CLAUDE.md](/CLAUDE.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹
- [AWS Lambda Documentation](https://docs.aws.amazon.com/lambda/)
- [dbt Documentation](https://docs.getdbt.com/)
- [DuckDB Documentation](https://duckdb.org/docs/)

## ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. Phase 2ä»¥é™ã®å®Ÿè£…ã«å‚åŠ ã™ã‚‹å ´åˆã¯ã€è©²å½“ã™ã‚‹ãƒ•ã‚§ãƒ¼ã‚ºã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª
2. å®Ÿè£…å‰ã«æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç†è§£
3. ãƒ†ã‚¹ãƒˆã‚’å¿…ãšä½œæˆ
4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ModerationCraftãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«æº–æ‹ 

---

*æœ€çµ‚æ›´æ–°: 2024å¹´2æœˆ*
*æ¬¡æœŸæ›´æ–°äºˆå®š: Phase 2å®Ÿè£…é–‹å§‹æ™‚*